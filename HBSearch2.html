<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    #results {
      grid-column: 1;
      background-color: lightblue;
      border: 1px solid black;
      padding: 10px;
    }

    #findbook {
      grid-column: 2;
      background-color: lightgreen;
      border: 1px solid black;
      padding: 10px;
    }

    div.header {
      grid-column: 1 / 3;
      background-color: lightyellow;
      border: 1px solid black;
      padding: 10px;
    }

    #container {
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      width: 80%;
      height: 50vh;
      background-color: lightgray;
      border: 1px solid black;
      padding: 10px;
      margin: 0;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      overflow-y: auto;
    }

    #select-all {
      margin: 2px;
      font-size: 12px;
    }

    [name="url"] {
      margin: 2px;
      flex-basis: 25%;
      font-size: 12px;
    }

    /* æ–°å¢çš„æ¨£å¼ */
    .progress-container {
      margin: 10px 0;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 20px;
      background: linear-gradient(45deg, #4CAF50, #45a049);
      width: 0%;
      transition: width 0.3s ease;
      text-align: center;
      line-height: 20px;
      color: white;
      font-size: 12px;
    }

    .status-info {
      margin: 10px 0;
      padding: 5px;
      background-color: #e8f4f8;
      border-radius: 5px;
      font-size: 14px;
    }

    .speed-control {
      margin: 10px 0;
      padding: 10px;
      background-color: #fff3cd;
      border-radius: 5px;
    }

    .speed-control label {
      display: block;
      margin: 5px 0;
    }

    .speed-control input[type="range"] {
      width: 100%;
    }

    .batch-control {
      margin: 10px 0;
      padding: 10px;
      background-color: #d1ecf1;
      border-radius: 5px;
    }

    .pause-button {
      background-color: #ffc107;
      color: black;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      margin-left: 10px;
    }

    .pause-button:hover {
      background-color: #e0a800;
    }

    .error-info {
      color: red;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>

  <title>Hyread é›»å­æ›¸47é¤¨æŸ¥è©¢-æ™ºèƒ½é˜²Banç‰ˆ</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    var hyread_urls = [];
    var isSearching = false;
    var isPaused = false;
    var searchQueue = [];
    var currentBatch = 0;
    var totalBatches = 0;
    var failedRequests = 0;
    var successfulRequests = 0;

    // å‹•æ…‹å»¶é²é…ç½®
    var delayConfig = {
      base: 1000,        // åŸºç¤å»¶é² 1ç§’
      random: 500,       // éš¨æ©Ÿå»¶é²ç¯„åœ 0-500ms
      batchDelay: 5000,  // æ‰¹æ¬¡é–“å»¶é² 5ç§’
      errorMultiplier: 2  // éŒ¯èª¤æ™‚å»¶é²å€æ•¸
    };

    $(document).ready(function () {
      updateDelayDisplay();
      
      $("#search-button").click(function () {
        if (isSearching) {
          pauseSearch();
          return;
        }
        
        $("#results").empty();
        $("#findbook").empty();
        var book_name = $("#book-name").val();
        if (!book_name.trim()) {
          alert("è«‹è¼¸å…¥æ›¸å");
          return;
        }
        
        var bookNameUrl = "https://ebook.hyread.com.tw/searchList.jsp?search_field=FullText&search_input=" + encodeURIComponent(book_name);
        
        $.ajax({
          url: bookNameUrl,
          headers: {
            'User-Agent': getRandomUserAgent()
          },
          timeout: 15000,
          success: function (data) {
            var soup = $(data);
            var book_titles = soup.find('div.book-title-01');
            var book_dict = {};
            
            for (var i = 0; i < book_titles.length; i++) {
              var book_url = book_titles.eq(i).find('a');
              if (book_url.length > 0) {
                var href = book_url.attr('href');
                if (href) {
                  var match = href.match(/id=(\d+)/);
                  if (match) {
                    var book_id = match[1];
                    book_dict[i] = book_url.text();
                    var html_text = '<div><input type="text" value="' + book_dict[i] + '" id="clipborad-text-' + i + '" data-id="' + book_url.attr('href') + '"><button onclick="copyToClipboard(' + i + ')">æ‰¾é€™æœ¬</button></div>';
                    $("#results").append(html_text);
                  }
                }
              }
            }
            
            if (Object.keys(book_dict).length === 0) {
              $("#results").html('<label>æœªæ‰¾åˆ°ç›¸é—œæ›¸ç±</label>');
            }
          },
          error: function (error) {
            $("#results").html('<label>é€£ç·šéŒ¯èª¤: ' + error.statusText + '</label>');
          }
        });
      });
    });

    // éš¨æ©Ÿç”¨æˆ¶ä»£ç†
    function getRandomUserAgent() {
      var userAgents = [
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36',
        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0',
        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.1 Safari/605.1.15'
      ];
      return userAgents[Math.floor(Math.random() * userAgents.length)];
    }

    // å‹•æ…‹å»¶é²å‡½æ•¸
    function getDynamicDelay() {
      var baseDelay = delayConfig.base;
      var randomDelay = Math.random() * delayConfig.random;
      var errorDelay = failedRequests > 0 ? (failedRequests * delayConfig.errorMultiplier * 1000) : 0;
      return baseDelay + randomDelay + errorDelay;
    }

    // æ›´æ–°å»¶é²é¡¯ç¤º
    function updateDelayDisplay() {
      var currentDelay = getDynamicDelay();
      $("#current-delay").text((currentDelay / 1000).toFixed(1) + "ç§’");
    }

    // æš«åœ/ç¹¼çºŒæœå°‹
    function pauseSearch() {
      isPaused = !isPaused;
      $("#search-button").text(isPaused ? "ç¹¼çºŒæœå°‹" : (isSearching ? "æš«åœæœå°‹" : "æœå°‹"));
      $("#pause-status").text(isPaused ? "å·²æš«åœ" : "é€²è¡Œä¸­");
    }

    function copyToClipboard(i) {
      var copyText = document.getElementById("clipborad-text-" + i).dataset.id;
      searchBookIntelligent(copyText);
    }

    // æ™ºèƒ½æœå°‹å‡½æ•¸
    function searchBookIntelligent(bookID) {
      if (isSearching) {
        alert("æ­£åœ¨æœå°‹ä¸­ï¼Œè«‹ç¨å€™...");
        return;
      }

      isSearching = true;
      isPaused = false;
      failedRequests = 0;
      successfulRequests = 0;
      
      $("#search-button").text("æš«åœæœå°‹");
      $("#findbook").html("æº–å‚™æœå°‹...");
      
      var selectedUrls = window.hyread_urls.slice();
      if (selectedUrls.length === 0) {
        alert("è«‹å…ˆé¸æ“‡è¦æŸ¥è©¢çš„åœ–æ›¸é¤¨");
        isSearching = false;
        $("#search-button").text("æœå°‹");
        return;
      }

      // åˆ†æ‰¹è™•ç†
      var batchSize = parseInt($("#batch-size").val()) || 5;
      var batches = [];
      for (var i = 0; i < selectedUrls.length; i += batchSize) {
        batches.push(selectedUrls.slice(i, i + batchSize));
      }
      
      totalBatches = batches.length;
      currentBatch = 0;
      
      updateProgress(0, selectedUrls.length);
      updateStatus("é–‹å§‹æœå°‹...", 0, selectedUrls.length);
      
      processBatchesSequentially(batches, bookID);
    }

    // ä¾åºè™•ç†æ‰¹æ¬¡
    async function processBatchesSequentially(batches, bookID) {
      var allResults = [];
      
      for (var batchIndex = 0; batchIndex < batches.length && !isPaused; batchIndex++) {
        currentBatch = batchIndex + 1;
        updateStatus(`è™•ç†ç¬¬ ${currentBatch}/${totalBatches} æ‰¹æ¬¡`, successfulRequests + failedRequests, batches.flat().length);
        
        var batchResults = await processBatch(batches[batchIndex], bookID);
        allResults = allResults.concat(batchResults.filter(r => r != undefined));
        
        // æ‰¹æ¬¡é–“å»¶é²
        if (batchIndex < batches.length - 1) {
          updateStatus(`æ‰¹æ¬¡é–“ä¼‘æ¯ ${delayConfig.batchDelay/1000} ç§’...`, successfulRequests + failedRequests, batches.flat().length);
          await delay(delayConfig.batchDelay);
        }
      }
      
      // é¡¯ç¤ºæœ€çµ‚çµæœ
      displayFinalResults(allResults);
      
      isSearching = false;
      isPaused = false;
      $("#search-button").text("æœå°‹");
      updateStatus("æœå°‹å®Œæˆ", successfulRequests + failedRequests, batches.flat().length);
    }

    // è™•ç†å–®å€‹æ‰¹æ¬¡
    async function processBatch(urls, bookID) {
      var promises = urls.map(async (url, index) => {
        while (isPaused) {
          await delay(1000);
        }
        
        var dynamicDelay = getDynamicDelay();
        await delay(dynamicDelay);
        updateDelayDisplay();
        
        var api = url + "/" + bookID;
        console.log("æ­£åœ¨æŸ¥è©¢: " + api);
        
        try {
          var response = await fetch(api, {
            headers: {
              'User-Agent': getRandomUserAgent(),
              'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
              'Accept-Language': 'zh-TW,zh;q=0.9,en;q=0.8',
              'Cache-Control': 'no-cache'
            },
            timeout: 10000
          });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          var response_text = await response.text();
          var result = parseBookResponse(response_text, api);
          
          if (result) {
            successfulRequests++;
            updateProgress(successfulRequests + failedRequests, window.hyread_urls.length);
          } else {
            failedRequests++;
          }
          
          return result;
          
        } catch (error) {
          console.error("è«‹æ±‚å¤±æ•—: " + api, error);
          failedRequests++;
          updateProgress(successfulRequests + failedRequests, window.hyread_urls.length);
          
          // éŒ¯èª¤æ™‚å¢åŠ å»¶é²
          delayConfig.base = Math.min(delayConfig.base * 1.2, 5000);
          
          return null;
        }
      });
      
      return await Promise.all(promises);
    }

    // è§£ææ›¸ç±å›æ‡‰
    function parseBookResponse(response_text, api) {
      try {
        var soup = new DOMParser().parseFromString(response_text, "text/html");
        
        if (soup.querySelector('img[src="/Template/RWD3.0/images/nosale2_pic.png"]')) {
          return null; // æœ¬é¤¨ç„¡æ­¤æ›¸
        }
        
        var book_title = soup.querySelector('h3');
        var book_hits = soup.querySelector('.date');
        var my_state_button = soup.querySelector('#myStateButton');
        
        if (!book_title || !my_state_button) {
          return null;
        }
        
        var button_text = my_state_button.textContent.trim();
        var output = "";
        
        if (button_text.includes("è¨ˆæ¬¡æœå‹™")) {
          var meta_tag = soup.querySelector("meta[property='og:title']");
          if (meta_tag) {
            var freeLibName = meta_tag.getAttribute("content");
            if (freeLibName) {
              var freeLibName_list = freeLibName.split(" ");
              var library_name = freeLibName_list[freeLibName_list.length - 1];
              output = "é¤¨åˆ¥: " + button_text + "-" + library_name;
            } else {
              output = "é¤¨åˆ¥: " + button_text;
            }
          }
        } else {
          output = "é¤¨åˆ¥: " + button_text;
        }
        
        if (book_hits) {
          output += " >>> [äººæ°£" + book_hits.textContent + "]";
        }
        
        output += "<br>æ›¸å: <a href=\"" + api + "\" target=\"_blank\">" + book_title.textContent + "</a><br>";
        
        var collection = soup.querySelector('#Collection');
        var collection2 = soup.querySelector('#combineSite0');
        
        if (collection && collection.textContent) {
          output += "ç‹€æ…‹: " + collection.textContent + "<br>";
        } else if (collection2 && collection2.textContent) {
          output += "ç‹€æ…‹: " + collection2.textContent + "<br>";
        }
        
        return output;
        
      } catch (error) {
        console.error("è§£æå›æ‡‰æ™‚ç™¼ç”ŸéŒ¯èª¤:", error);
        return null;
      }
    }

    // é¡¯ç¤ºæœ€çµ‚çµæœ
    function displayFinalResults(results) {
      if (results.length === 0) {
        document.getElementById("findbook").innerHTML = "æŸ¥ç„¡æ­¤æ›¸æˆ–æ‰€æœ‰è«‹æ±‚éƒ½å¤±æ•—äº†";
      } else {
        var output = results.join("<hr>");
        document.getElementById("findbook").innerHTML = output;
      }
    }

    // æ›´æ–°é€²åº¦æ¢
    function updateProgress(current, total) {
      var percentage = (current / total) * 100;
      var progressBar = document.querySelector('.progress-bar');
      progressBar.style.width = percentage + '%';
      progressBar.textContent = current + '/' + total;
    }

    // æ›´æ–°ç‹€æ…‹è³‡è¨Š
    function updateStatus(message, processed, total) {
      $("#status-message").text(message);
      $("#processed-count").text(processed);
      $("#total-count").text(total);
      $("#success-count").text(successfulRequests);
      $("#failed-count").text(failedRequests);
    }

    // å»¶é²å‡½æ•¸
    const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // èª¿æ•´å»¶é²è¨­å®š
    function adjustDelay() {
      delayConfig.base = parseInt($("#delay-slider").val());
      delayConfig.batchDelay = parseInt($("#batch-delay-slider").val());
      updateDelayDisplay();
    }

  </script>
</head>

<body>
  <div class="header">
    <h1>Hyread é›»å­æ›¸47é¤¨æŸ¥è©¢-æ™ºèƒ½é˜²Banç‰ˆ</h1>
    
    <!-- é€Ÿåº¦æ§åˆ¶å€ -->
    <div class="speed-control">
      <h3>ğŸš€ æ™ºèƒ½é€Ÿåº¦æ§åˆ¶</h3>
      <label>
        è«‹æ±‚é–“éš”: <span id="current-delay">1.0ç§’</span>
        <input type="range" id="delay-slider" min="500" max="5000" value="1000" onchange="adjustDelay()">
        (0.5ç§’ - 5ç§’)
      </label>
      <label>
        æ‰¹æ¬¡é–“å»¶é²: <span id="batch-delay-display">5ç§’</span>
        <input type="range" id="batch-delay-slider" min="3000" max="15000" value="5000" onchange="adjustDelay(); document.getElementById('batch-delay-display').textContent = (this.value/1000) + 'ç§’'">
        (3ç§’ - 15ç§’)
      </label>
    </div>

    <!-- æ‰¹æ¬¡æ§åˆ¶å€ -->
    <div class="batch-control">
      <h3>ğŸ“¦ æ‰¹æ¬¡è™•ç†è¨­å®š</h3>
      <label>
        æ¯æ‰¹æ¬¡è™•ç†æ•¸é‡: 
        <select id="batch-size">
          <option value="3">3å€‹é¤¨ (æœ€å®‰å…¨)</option>
          <option value="5" selected>5å€‹é¤¨ (æ¨è–¦)</option>
          <option value="8">8å€‹é¤¨ (è¼ƒå¿«)</option>
          <option value="10">10å€‹é¤¨ (å¿«é€Ÿä½†é¢¨éšªè¼ƒé«˜)</option>
        </select>
      </label>
    </div>

    <!-- é€²åº¦é¡¯ç¤ºå€ -->
    <div class="progress-container">
      <div class="progress-bar">0/0</div>
    </div>
    
    <div class="status-info">
      <div>ğŸ“Š ç‹€æ…‹: <span id="status-message">å¾…æ©Ÿä¸­</span> <span id="pause-status"></span></div>
      <div>âœ… æˆåŠŸ: <span id="success-count">0</span> | âŒ å¤±æ•—: <span id="failed-count">0</span> | ğŸ”„ å·²è™•ç†: <span id="processed-count">0</span>/<span id="total-count">0</span></div>
    </div>

    <!-- åœ–æ›¸é¤¨é¸æ“‡å€ -->
    <div id="container">
      <label for="select-all">
        <input type="checkbox" id="select-all" name="select-all" value="all">
        å…¨é¸
      </label>
      <br>
    </div>
    
    <script>
      // åŸæœ‰çš„åœ–æ›¸é¤¨åˆ—è¡¨å’Œ checkbox ç”Ÿæˆé‚è¼¯
      var urls = [
        ["https://tpml.ebook.hyread.com.tw", "å°åŒ—å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://tphcc.ebook.hyread.com.tw", "æ–°åŒ—å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://klccab.ebook.hyread.com.tw", "åŸºéš†å¸‚æ–‡åŒ–å±€"],
        ["https://ncl.ebook.hyread.com.tw", "åœ‹å®¶åœ–æ›¸é¤¨"],
        ["https://ebook.nlpi.edu.tw/", "åœ‹ç«‹å…¬å…±è³‡è¨Šåœ–æ›¸é¤¨"],
        ["https://ntledu.ebook.hyread.com.tw", "åœ‹ç«‹è‡ºç£åœ–æ›¸é¤¨"],
        ["https://tycccgov.ebook.hyread.com.tw", "æ¡ƒåœ’å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://hcmlgov.ebook.hyread.com.tw", "æ–°ç«¹å¸‚åœ–æ›¸é¤¨"],
        ["https://hchcc.ebook.hyread.com.tw", "æ–°ç«¹ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://taichunggov.ebook.hyread.com.tw", "è‡ºä¸­å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://bocach.ebook.hyread.com.tw", "å½°åŒ–ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://chcedu.ebook.hyread.com.tw", "å½°åŒ–é›²ç«¯é›»å­æ›¸åº«"],
        ["https://ilccb.ebook.hyread.com.tw", "å®œè˜­ç¸£æ”¿åºœæ–‡åŒ–å±€"],
        ["https://hccc.ebook.hyread.com.tw", "èŠ±è“®ç¸£æ–‡åŒ–å±€"],
        ["https://cabcygov.ebook.hyread.com.tw", "å˜‰ç¾©å¸‚æ”¿åºœæ–‡åŒ–å±€"],
        ["https://cycabgov.ebook.hyread.com.tw", "å˜‰ç¾©ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://nthccgov.ebook.hyread.com.tw", "å—æŠ•ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://pthggov.ebook.hyread.com.tw", "å±æ±ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://cclttct.ebook.hyread.com.tw", "è‡ºæ±ç¸£æ”¿åºœæ–‡åŒ–è™•"],
        ["https://phhcc.ebook.hyread.com.tw", "æ¾æ¹–ç¸£åœ–æ›¸é¤¨"],
        ["https://miaolilib.ebook.hyread.com.tw", "è‹—æ —ç¸£ç«‹åœ–æ›¸é¤¨"],
        ["https://mlcg.ebook.hyread.com.tw", "è‹—æ —å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://sanwan.ebook.hyread.com.tw", "è‹—æ —ç¸£ä¸‰ç£é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://dahu.ebook.hyread.com.tw", "è‹—æ —ç¸£å¤§æ¹–é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://gungguan.ebook.hyread.com.tw", "è‹—æ —ç¸£å…¬é¤¨é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://xihu.ebook.hyread.com.tw", "è‹—æ —ç¸£è¥¿æ¹–é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://nanchuang.ebook.hyread.com.tw", "è‹—æ —ç¸£å—åº„é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://houlong.ebook.hyread.com.tw", "è‹—æ —ç¸£å¾Œé¾é®ç«‹åœ–æ›¸é¤¨"],
        ["https://yuanli.ebook.hyread.com.tw", "è‹—æ —ç¸£è‹‘è£¡é®ç«‹åœ–æ›¸é¤¨"],
        ["https://tungshiau.ebook.hyread.com.tw", "è‹—æ —ç¸£é€šéœ„é®ç«‹åœ–æ›¸é¤¨"],
        ["https://zaociao.ebook.hyread.com.tw", "è‹—æ —ç¸£é€ æ©‹é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://stan.ebook.hyread.com.tw", "è‹—æ —ç¸£ç…æ½­é„‰åœ–æ›¸é¤¨"],
        ["https://toufenlib.ebook.hyread.com.tw", "è‹—æ —ç¸£é ­ä»½å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://touwu.ebook.hyread.com.tw", "è‹—æ —ç¸£é ­å±‹é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://ncltrccs.ebook.hyread.com.tw", "åœ‹å®¶åœ–æ›¸é¤¨è‡ºç£æ¼¢å­¸è³‡æºä¸­å¿ƒæš¨è‡ºç£å­¸è¡“æ•¸ä½è³‡æºä¸­å¿ƒé›»å­æ›¸å¹³å°"],
        ["https://ylccb.ebook.hyread.com.tw", "é›²æ—ç¸£å…¬å…±åœ–æ›¸é¤¨"],
        ["https://nthccgov.ebook.hyread.com.tw", "å—æŠ•ç¸£æ”¿åºœå…¬å…±åœ–æ›¸é¤¨"],
        ["https://hsinrong.ebook.hyread.com.tw", "æ¬£æ¦®ç´€å¿µåœ–æ›¸é¤¨"],
        ["https://jianlib.ebook.hyread.com.tw", "èŠ±è“®ç¸£å‰å®‰é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://hualienlib.ebook.hyread.com.tw", "èŠ±è“®ç¸£èŠ±è“®å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://shlinlib.ebook.hyread.com.tw", "ç§€æ—é„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://sinchenlib.ebook.hyread.com.tw", "æ–°åŸé„‰ç«‹åœ–æ›¸é¤¨"],
        ["https://tnml.ebook.hyread.com.tw", "è‡ºå—å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://ksml.ebook.hyread.com.tw", "é«˜é›„å¸‚ç«‹åœ–æ›¸é¤¨"],
        ["https://kinmen.ebook.hyread.com.tw", "é‡‘é–€ç¸£æ–‡åŒ–å±€"],
        ["https://lieyu.ebook.hyread.com.tw", "é‡‘é–€ç¸£çƒˆå¶¼é„‰å…¬æ‰€"],
        ["https://matsucc.ebook.hyread.com.tw", "é€£æ±Ÿç¸£å…¬å…±åœ–æ›¸é¤¨"],
      ];

      var container = document.getElementById("container");
      var selectAll = document.getElementById("select-all");

      function createCheckboxes() {
        urls.forEach(function (url, index) {
          var id = "url-" + (index + 1).toString().padStart(2, "0");
          var label = document.createElement("label");
          label.setAttribute("for", id);
          var checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.name = "url";
          checkbox.value = url[0];
          checkbox.id = id;
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(url[1]));
          container.appendChild(label);
          container.appendChild(document.createElement("br"));
        });
      }

      function updateHyreadUrls() {
        hyread_urls = [];
        var checkboxes = document.getElementsByName("url");
        checkboxes.forEach(function (checkbox) {
          if (checkbox.checked) {
            hyread_urls.push(checkbox.value);
          }
        });
        console.log("å·²é¸æ“‡é¤¨æ•¸:", hyread_urls.length);
        window.hyread_urls = hyread_urls;
      }

      function handleSelectAllChange() {
        var checkboxes = document.getElementsByName("url");
        checkboxes.forEach(function (checkbox) {
          checkbox.checked = selectAll.checked;
        });
        updateHyreadUrls();
      }

      function handleCheckboxChange() {
        var allCheckboxes = document.getElementsByName("url");
        var checked = Array.from(allCheckboxes).filter(function (checkbox) {
          return checkbox.checked;
        });
        selectAll.checked = checked.length === urls.length;
        updateHyreadUrls();
      }

      createCheckboxes();
      selectAll.addEventListener("change", handleSelectAllChange);

      var selectedCheckboxes = document.getElementsByName("url");
      selectedCheckboxes.forEach(function (checkbox) {
        checkbox.addEventListener("change", handleCheckboxChange);
      });

      // Cookie ä¿å­˜å’Œæ¢å¾©åŠŸèƒ½
      for (var i = 0; i < selectedCheckboxes.length; i++) {
        selectedCheckboxes[i].addEventListener("change", function () {
          document.cookie = "checkbox-" + this.id + "=" + this.checked;
        });
      }

      window.onload = function () {
        var cookies = document.cookie.split("; ");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].split("=");
          if (cookie[0].startsWith("checkbox-")) {
            var element = document.getElementById(cookie[0].slice(9));
            if (element) {
              element.checked = cookie[1] == "true";
            }
          }
        }
        updateHyreadUrls();
      };
    </script>
  </div>
  
  <input type="text" id="book-name" placeholder="è«‹è¼¸å…¥æŸ¥æ‰¾æ›¸å">
  <button id="search-button">æœå°‹</button>
  
  <div id="results"></div>
  <div id="findbook"></div>
</body>

</html>